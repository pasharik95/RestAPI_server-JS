// import module 'passport' for working with passportjs
var passport = require('passport'),
    LocalRegistry = LocalStrategy = require('passport-local').Strategy;

// include model of user
var User = require('model').User;

// set local strategy for loginning user
passport.use(new LocalStrategy(
    function(username, password, done)
    {
        // find user in db
        User.findOne({ username: username },
            function (err, user)
            {
                if (err)
                {
                    return done(err);
                }

                if (!user)
                {
                    return done(null, false, { message: 'Incorrect username.' });
                }

                if (!user.password == password)
                {
                    return done(null, false, { message: 'Incorrect password.' });
                }

                // success of login
                return done(null, user);
            });
    }
));

// serialize user to session
passport.serializeUser(
    function(user, done)
    {
        done(null, user.id);
    });

// deserialize user to session
passport.deserializeUser(
    function(id, done)
    {
        User.findById(id,
            function(err, user)
            {
                 done(err, user);
            });
    });

// exports module passport with configurations
module.exports = passport;